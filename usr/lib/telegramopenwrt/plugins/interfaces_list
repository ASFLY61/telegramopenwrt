#!/bin/sh                                                                                                                                                                                                                    
                                                                                                                                                                                                                             
old=$IFS                                                                                                                                                                                                                     
IFS=$'\n'                                                                                                                                                                                                                    
TOTAL=0                                                                                                                                                                                                                      
                                                                                                                                                                                                                             
echo "*Network Interfaces*"                                                                                                                                                                                                             
                                                                                                                                                                                                                             
to_parse=$(ubus call network.interface dump)                                                                                                                                                                                 
                                                                                                                                                                                                                             
for iface in $(jsonfilter -s "$to_parse" -e '@.interface[*].interface')                                                                                                                                                      
do                                                                                                                                                                                                                           
        echo "interface: $iface"                                                                                                                                                                                             
        echo "up:" $(jsonfilter -s "$to_parse" -e "@.interface[@.interface=\"$iface\"].up")                                                                                                                                  
        echo "device:" $(jsonfilter -s "$to_parse" -e "@.interface[@.interface=\"$iface\"].device")                                                                                                                          
        echo "proto:" $(jsonfilter -s "$to_parse" -e "@.interface[@.interface=\"$iface\"].proto")                                                                                                                            
        echo "ipv4-address:"                                                                                                                                                                                                 
        for addr in $(jsonfilter -s "$to_parse" -e "@.interface[@.interface=\"$iface\"]['ipv4-address'][*]")                                                                                                                 
        do                                                                                                                                                                                                                   
                ip=$(jsonfilter -s "$addr" -e "@['address']")                                                                                                                                                                
                mask=$(jsonfilter -s "$addr" -e "@['mask']")                                                                                                                                                                 
                echo -en "\t $ip/$mask\n"                                                                                                                                                                                    
        done                                                                                                                                                                                                                 
        echo "routes:"                                                                                                                                                                                                       
        for routes in $(jsonfilter -s "$to_parse" -e "@.interface[@.interface=\"$iface\"]['route'][*]")                                                                                                                      
        do                                                                                                                                                                                                                   
                source=$(jsonfilter -s "$routes" -e "@['source']")                                                                                                                                                           
                target=$(jsonfilter -s "$routes" -e "@['target']")                                                                                                                                                           
                nexthop=$(jsonfilter -s "$routes" -e "@['nexthop']")                                                                                                                                                         
                echo -en "\tfrom $source to $target via $nexthop\n"                                                                                                                                                          
        done                                                                                                                                                                                                                 
        echo "dns-server:" $(jsonfilter -s "$to_parse" -F "|" -e "@.interface[@.interface=\"$iface\"]['dns-server'][*]")                                                                                                     
        echo "dns-search:" $(jsonfilter -s "$to_parse" -F "|" -e "@.interface[@.interface=\"$iface\"]['dns-search'][*]")                                                                                                     
        echo "--------------------------------------------------"                                                                                                                                                            
done                                                                                                                                                                                                                         
IFS=$old